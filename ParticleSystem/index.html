<!DOCTYPE html>

<html>

<head>
	<title>Learning WebGL &mdash; lesson 1</title>
	<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
	<!-- glMatrix version 2.2.0 -->
	<script type="text/javascript" src="gl-matrix-min.js"></script>
	<script id="vertex-save" type="x-shader/x-vertex">
		precision lowp float;
	    attribute vec3 aVertexVelocities; //rename aParticleVelocities
	    attribute vec2 aParticleIndex; 

 	    uniform sampler2D uParticleStartPositions; //rename uParticleStartPositions
	   	uniform float uTime;

	    varying vec3 newPosition;
	   	
	    void main(void) {
		   	vec3 oldPosition = texture2D(uParticleStartPositions, aParticleIndex).rgb;
		   	// vec3 oldPosition = texture2D(uParticleStartPositions,(0.5 + vec2(aParticleIndex.s, aParticleIndex.t)/2.0)).rgb;

	    	if (uTime > 100.0 ) { // make dots reverse direction
	    		 newPosition = oldPosition - (1.0 * aVertexVelocities);
			}
			// updated position to be written to texture in frag shader
			else {
				newPosition = oldPosition + aVertexVelocities;
			}
			vec2 glSpaceIndex = 2.0 * (aParticleIndex - 0.5);
			// set data write location 
	    	gl_Position = vec4(glSpaceIndex, 0.0, 1.0); 

	    	// Set particle size
	    	gl_PointSize = 1.0;
	    }

	</script>
	<script id="fragment-save" type="x-shader/x-fragment">
	    precision lowp float;
	 
	    varying vec3 newPosition;
	   	
	    void main(void) {
	    	// Saves the new position to location determined in vertex shader
  			gl_FragColor = vec4(newPosition, 1.0);
	    }
	</script>

	<script id="vertex-render" type="x-shader/x-vertex">
		precision lowp float;

	    attribute vec3 aVertexVelocities; //rename aParticleVelocities
	    attribute vec2 aParticleIndex; 
	   
 	    uniform sampler2D uParticleStartPositions;  //rename uParticleStartPositions
	    uniform mat4 uMVMatrix; // necessary?
	    uniform mat4 uPMatrix;
	    
	    varying vec3 newPosition; //necessary?
	   	varying vec3 v_color;
	   	
	    void main(void) {
	    
	    	// Index into the buffer uParticleStartPositions with aParticleIndex 
			vec3 oldPosition = texture2D(uParticleStartPositions, aParticleIndex).rgb;
				    		
	       	gl_Position = uPMatrix * vec4(oldPosition, 1.0);//write 

	       	gl_PointSize = 1.0;

	       	// ---SET COLOR
			v_color = vec3(aParticleIndex, 0.0);
			//gl_Position = vec4(v_color - 0.5,1.0);
			//v_color = (oldPosition);
			//v_color = vec3(1.0);
		    // ---
	    }

	</script>
	<script id="fragment-render" type="x-shader/x-fragment">
	    precision highp float;
	    	
	    varying vec3 newPosition; //necessary?
	   	varying vec3 v_color;
	    void main(void) {
	    	
    			gl_FragColor = vec4(v_color, 0.4);
   		    }
	</script>
	<script src="Particle.js" type="text/javascript"></script>
	<script src="ParticleSystem.js" type="text/javascript"></script>
	<script src="View.js" type="text/javascript"></script>
	</head>

<body onload= "webGLStart();">
	<canvas id="glcanvas" width="1024" height="1024">
		Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
	</canvas>
</body>



